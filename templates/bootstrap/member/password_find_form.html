{% extends "base.html" %}

{% block head %}
    {% if certificate.is_use_cert %}
        <script src="{{ url_for('static', path='/js/certify.js') }}" async></script>
    {% endif %}
{% endblock head %}

{% block title %}회원정보 찾기{% endblock title %}
{% block subtitle %}회원정보 > 비밀번호 찾기{% endblock subtitle %}

{% block content %}
<div id="find_info" class="new_win {% if is_view_cert %}cert{% endif %}">
    <div class="new_win_con">
        <form name="fpasswordlost" action="{{ url_for('find_member_password') }}" onsubmit="return fpasswordlost_submit(this);" method="post" autocomplete="off">
            <input type="hidden" name="token" value="">
            <h3>회원가입정보로 비밀번호 찾기</h3>
            <fieldset id="info_fs">
                <p>
                    아이디, 이메일 주소를 입력해주세요.<br>
                    등록된 회원정보가 있다면 해당 이메일로 비밀번호를 재설정할 수 있는 링크를 보내드립니다.
                </p>
                <label for="mb_id" class="blind">아이디<strong class="blind">필수</strong></label>
                <input type="text" name="mb_id" id="mb_id" required="" class="required frm_input half_input alnum_" size="30" placeholder="아이디">
                <label for="mb_email" class="blind">E-mail 주소<strong class="blind">필수</strong></label>
                <input type="text" name="mb_email" id="mb_email" required="" class="required frm_input full_input email" size="100" placeholder="E-mail 주소">
            </fieldset>

            <!-- Captcha Start -->
            <fieldset id="captcha" class="captcha">
                {% include captcha_widget(request) ignore missing %}
            </fieldset>
            <!-- Captcha End -->

            <div class="win_btn">
                <button type="submit" class="btn_submit">비밀번호 재설정 메일 발송</button>
            </div>
        </form>
    </div>

    {% if is_view_cert %}
    <div class="new_win_con find_btn">
        <h3>본인인증으로 비밀번호 찾기</h3>
        <form name="form_certification" action="{{ url_for('find_member_password_certificate') }}" method="post" autocomplete="off">
            <input type="hidden" name="token" value="">
            <input type="hidden" name="user_name" value="">
            <input type="hidden" name="dupinfo" value="">
            <fieldset id="info_fs">
                <p>
                    아이디 입력 후, 본인인증을 진행해주세요.<br>
                    입력된 아이디와 본인인증 정보가 일치할 경우, 비밀번호를 재설정할 수 있습니다.
                </p>
                <label for="mb_id_cert" class="blind">아이디<strong class="blind">필수</strong></label>
                <input type="text" name="mb_id" id="mb_id_cert" required="" class="required frm_input half_input alnum_" size="30" placeholder="아이디">
            </fieldset>
            
            <div class="cert_btn">
                {% if certificate.cert_simple %}
                    <button type="button" id="win_sa_kakao_cert" class="btn_submit win_sa_cert" data-type="">간편인증</button>
                {% endif %}
                {% if certificate.cert_hp %}
                    <button type="button" id="win_hp_cert" class="btn_submit">휴대폰 본인확인</button>
                {% endif %}
                {% if certificate.cert_ipin %}
                    <button type="button" id="win_ipin_cert" class="btn_frmline">아이핀 본인확인</button>
                {% endif %}
            </div>
        </form>
    </div>
    {% endif %}
</div>
<script>
"use strict";

function fpasswordlost_submit(f) {
    // captcha 사용시
    if (typeof check_captcha === "function") {
        if (!check_captcha(f)) {
            return false;
        }
    }

    f.token.value = generate_token();

    return true;
}

function check_member_id() {
    if (!$("#mb_id_cert").val()) {
        alert("아이디를 입력해주세요.");
        $("#mb_id_cert").focus();
        return false;
    }
    return true;
}

$(function() {
    /**
    * 본인인증 관련 스크립트
    */
{% if certificate.is_use_cert %}
    const cert_simple = "{{ certificate.cert_simple }}";
    const cert_ipin = "{{ certificate.cert_ipin }}";
    const cert_hp = "{{ certificate.cert_hp }}";

    const common_param = "pageType=find";

    // 이니시스 간편인증
    if (cert_simple) {
        $(".win_sa_cert").click(function() {
            if (!check_member_id()) {
                return false;
            }

            let params = "?directAgency=" + $(this).data("type") + "&" + common_param;
            let request_url = "{{ url_for('get_certificate', provider='inicis', cert_type='simple') }}" + params;
            call_sa(request_url);
        });
    }

    // 아이핀 인증
    if (cert_ipin) {
        $("#win_ipin_cert").click(function() {
            if (!check_member_id()) {
                return false;
            }

            let params = "?" + common_param;
            let request_url = "G5_OKNAME_URL/ipin1.php" + params;
            certify_win_open('kcb-ipin', request_url);
            return;
        });
    }

    // 휴대폰인증
    if (cert_hp) {
        $("#win_hp_cert").click(function() {
            if (!check_member_id()) {
                return false;
            }

            let params = "?" + common_param;
            let request_url = ""
            // KCP 본인인증
            if (cert_hp == "kcp") {
                request_url = "{{ url_for('get_certificate', provider='kcp', cert_type='hp') }}" + params
            }
            certify_win_open(cert_hp + "-hp", request_url);
            return;
        });
    }
{% endif %}
});
</script>
{% endblock content %}